<!DOCTYPE html>
<html>
	<head>
		<title><%= htmlWebpackPlugin.options.title %></title>

		<style type="text/css">
			body {
				display: flex;
				flex-direction: column;

				background-color: black;
			}

			.row {
				display: flex;
				flex-direction: row;
				justify-content: center;
			}

			#screen {
				border: 2px blue solid;
				border-radius: 8px;
			}
		</style>

		<script type="application/javascript" defer>
			;(() => {
				let offset, height

				let dragging = false
				let dragFrom, dragTo

				const zoom = (o, h) => {
					offset = o
					height = h
					Fractal.render(offset, height)
				}

				const getMouseCoords = (ev) => {
					const bounds = ev.target.getBoundingClientRect()
					return [
						((ev.clientX - bounds.x) * ev.target.width) / bounds.width,
						((bounds.height - (ev.clientY - bounds.y)) * ev.target.height) /
							bounds.height,
					]
				}

				window.startDrag = (ev) => {
					ev.preventDefault()

					dragFrom = getMouseCoords(ev)
					dragging = true
				}

				window.mouseDrag = (ev) => {
					if (!dragging) {
						return
					}

					ev.preventDefault()

					dragTo = getMouseCoords(ev)
					if (dragFrom[0] > dragTo[0]) {
						;[dragFrom[0], dragTo[0]] = [dragTo[0], dragFrom[0]]
					}
					if (dragFrom[1] > dragTo[1]) {
						;[dragFrom[1], dragTo[1]] = [dragTo[1], dragFrom[1]]
					}

					Fractal.render(offset, height, [dragFrom, dragTo])
				}

				window.stopDrag = (ev) => {
					ev.preventDefault()

					const canvas = document.getElementById('screen')
					const dragCenter = [
						(dragFrom[0] + dragTo[0]) / 2,
						(dragFrom[1] + dragTo[1]) / 2,
					]
					const o = [
						offset[0] + (dragCenter[0] - canvas.width / 2) / canvas.width * height,
						offset[1] + (dragCenter[1] - canvas.height / 2) / canvas.height * height,
					]
					//const h = height * (dragTo[1] - dragFrom[1]) / canvas.height
					zoom(o, height)

					dragging = false
				}

				window.resetImage = () => {
					//zoom([-0.5557506, -0.5556], .000000001)
					zoom([-1.5, -1], 2)
				}

				document.addEventListener('DOMContentLoaded', () => {
					resetImage()
				})
			})()
		</script>
	</head>
	<body>
		<div class="row">
			<canvas
				id="screen"
				width="800"
				height="800"
				onmousedown="startDrag(event)"
				onmousemove="mouseDrag(event)"
				onmouseup="stopDrag(event)"
			/>
		</div>
		<div class="row">
			<button onclick="resetImage()">Reset</button>
		</div>
	</body>
</html>
